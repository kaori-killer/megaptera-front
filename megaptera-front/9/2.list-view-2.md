# ì¹´í…Œê³ ë¦¬ ëª©ë¡ ë³´ì—¬ì£¼ê¸°

ìƒí’ˆ ëª©ë¡ ë„ìš°ê¸°ì— ì„±ê³µí–ˆë‹¤ë©´, ì¹´í…Œê³ ë¦¬ ëª©ë¡ì„ ë§Œë“ ë‹¤.

1. Headerì— ì¹´í…Œê³ ë¦¬ ëª©ë¡ ë§Œë“¤ê¸°: `useFetchCategories` hook ë§Œë“¤ê¸°
2. ì¹´í…Œê³ ë¦¬ ëª©ë¡ ë³„ë¡œ ìƒí’ˆ ë°›ì•„ì˜¤ê¸°: ì¹´í…Œê³ ë¦¬ idë¥¼ ì´ìš©í•˜ì—¬ ìƒí’ˆ ë°›ì•„ì˜¤ê¸°

## ğŸ‹ 1. Headerì— ì¹´í…Œê³ ë¦¬ ëª©ë¡ ë§Œë“¤ê¸°

### ğŸ³ 1-1. ì¹´í…Œê³ ë¦¬ ë¶ˆëŸ¬ì˜¤ê¸° - Store

ë¨¼ì € Categoriesë¥¼ ë¶ˆëŸ¬ì˜¨ë‹¤. `ProductsStore` ì—ì„œ Productsë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ê²ƒê³¼ ë‹¤ë¥¼ ê²ƒ ì—†ë‹¤. ì´ë¥¼ ì¹´í…Œê³ ë¦¬ë¡œ ë³€ê²½í•´ì£¼ì.

```jsx
// src/stores/CategoriesStore.ts
import axios from 'axios';

import { singleton } from 'tsyringe';
import { Action, Store } from 'usestore-ts';

import { Category } from '../types';

// TODO : í™˜ê²½ë³€ìˆ˜ë¡œ ë¹¼ê¸°
const apiBaseUrl = 'https://shop-demo-api-01.fly.dev';

@singleton()
@Store()
export default class CategoriesStore {
  categories: Category[] = [];

  async fetchCategories() {
    this.setCategories([]);

    const { data } = await axios.get(`${apiBaseUrl}/categories`);
    const { categories } = data;

    this.setCategories(categories);
  }

  @Action()
  setCategories(categories: Category[]) {
    this.categories = categories;
  }
}
```

### ğŸ³ 1-2. ì¤‘ë³µì œê±° - Service

`ProductsStore` ì™€ `CategoriesStore` ëŠ” ë§ì€ ë¶€ë¶„ì´ ì¤‘ë³µë˜ê³  ì•ìœ¼ë¡œë„ ì¤‘ë³µì´ ë°œìƒí•  ë¶€ë¶„ì´ê¸° ë•Œë¬¸ì— ë”°ë¡œ `ApiService`ë¡œ ë¹¼ì£¼ì.

`ApiService` ë¡œ axios ë¶€ë¶„ì„ ë¹¼ì¤€ë‹¤. (ë’¤ë¡œ ìˆ¨ê¸´ë‹¤.) axiosëŠ” storeê°€ ì•Œ í•„ìš”ê°€ ì—†ëŠ” ì €ìˆ˜ì¤€ì— ê°€ê¹ê¸° ë•Œë¬¸ì´ë‹¤. axios, host, ì£¼ì†Œ ë“±ì€ ì €ìˆ˜ì¤€ì— ê°€ê¹ë‹¤. ë¬¼ë¡  axiosê°€ fetchë¥¼ ê°ì‹¸ê¸° ë•Œë¬¸ì— fetchë³´ë‹¤ëŠ” ê³ ìˆ˜ì¤€ì´ì§€ë§Œ, store ì…ì¥ì—ì„œ axiosëŠ” ì €ìˆ˜ì¤€ì— ê°€ê¹ë‹¤.

ê·¸ë¦¬ê³  `axios.create()` ëŠ” axiosì—ì„œ ì‚¬ìš©í•  ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì •ì˜í•˜ëŠ” ë©”ì„œë“œë¡œ, ì‚¬ìš©í•  ì„¤ì •ì„ ì •ì˜í•˜ê±°ë‚˜ ì¸í„°ì…‰íŠ¸ë¥¼ ì¶”ê°€í•˜ëŠ” ë“±ì˜ ì‘ì—…ì„ í•  ìˆ˜ ìˆë‹¤. ì½”ë“œì—ì„œëŠ” baseURLê°€ ì •ì˜ëœ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì´ìš©í•˜ì—¬ ë°”ë¡œ get ìš”ì²­ì„ í•˜ë„ë¡ ë§Œë“¤ì–´ì ¸ìˆë‹¤. ì´ ì½”ë“œë¥¼ í™œìš©í•˜ë©´ ë°ì´í„° ìš”ì²­ ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ì´ ë°”ë€” ìˆ˜ ìˆë‹¤.

```jsx
// src/services/ApiService.ts
import axios from 'axios';

import { Category, ProductSummary } from '../types';

const API_BASE_URL = process.env.API_BASE_URL
                     || 'https://shop-demo-api-01.fly.dev';

export default class ApiService {
  private instance = axios.create({
    baseURL: API_BASE_URL,
  });

  async fetchCategories(): Promise<Category[]> {
    const { data } = await this.instance.get('/categories');
    const { categories } = data;
    return categories;
  }

  async fetchProducts(): Promise<ProductSummary[]> {
    const { data } = await this.instance.get('/products');
    const { products } = data;
    return products;
  }
}

export const apiService = new ApiService();
```

ì´ë¥¼ storeì—ì„œ ë¶ˆëŸ¬ì˜¨ë‹¤.

`apiService` ë¡œ ë°›ì•„ì˜¨ ë°ì´í„°ëŠ” í”„ë¡œë¯¸ìŠ¤ë¥¼ ë°˜í™˜í•˜ë¯€ë¡œ awaitì™€ í•¨ê»˜ ì¨ì¤€ë‹¤.

```jsx
// src/stores/CategoriesStore.ts
import { singleton } from 'tsyringe';
import { Action, Store } from 'usestore-ts';

import { Category } from '../types';

import { apiService } from '../services/ApiService';

@singleton()
@Store()
export default class CategoriesStore {
  categories: Category[] = [];

  async fetchCategories() {
    this.setCategories([]);

    const categories = await apiService.fetchCategories();

    this.setCategories(categories);
  }

  @Action()
  setCategories(categories: Category[]) {
    this.categories = categories;
  }
}
```

ì´ì œ `useFetchCategories` ì—ì„œ Storeë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ë°›ì•„ì˜¤ë„ë¡ í•œë‹¤. `useFetchProducts` ì™€ ë‹¤ë¥¼ ê²Œ ì—†ë‹¤.

```jsx
// src/hooks/useFetchCategories.ts
import { useEffect } from 'react';

import { container } from 'tsyringe';
import { useStore } from 'usestore-ts';

import CategoriesStore from '../stores/CategoriesStore';

export default function useFetchCategories() {
  const store = container.resolve(CategoriesStore);

  const [{ categories }] = useStore(store);

  useEffect(() => {
    store.fetchCategories();
  }, [store]);

  return ({
    categories,
  });
}
```

## ğŸ‹ 2. ì¹´í…Œê³ ë¦¬ ëª©ë¡ ë³„ë¡œ ìƒí’ˆ ë°›ì•„ì˜¤ê¸°

### ğŸ³ 2-1. ì¹´í…Œê³ ë¦¬ id ë°›ì•„ì˜¤ê¸°

`query`, ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œëŠ” `serach` ë¼ê³  ë¶€ë¥´ëŠ” ê²ƒì„ ë°›ì•„ì˜¤ì.

```bash
window.location.search // ?categoryId=0BV000CAT0003
```

`Link` ì— ë‹´ì•„ë‘” ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° (ì¹´í…Œê³ ë¦¬ id)ë¥¼ ì‚¬ìš©í•˜ê¸° í•´ì•¼ í•œë‹¤. ë¦¬ì•¡íŠ¸ì—ì„œëŠ” ë¦¬ì•¡íŠ¸ ë¼ìš°í„°ê°€ ì œê³µí•˜ëŠ” í›… `useSarchParams` ë¥¼ ì´ìš©í•œë‹¤. ì´ëŠ” ì¿¼ë¦¬ ë¬¸ìì—´ì„ ê°€ì ¸ì˜¨ë‹¤. ë‚´ë¶€ì ìœ¼ë¡œ `window.location.search` ê°€ ì‚¬ìš©ë˜ê³  ìˆë‹¤.

get ë©”ì„œë“œëŠ” ì¸ìë¡œ ì¿¼ë¦¬ ì´ë¦„ì„ ë„£ì–´ì£¼ë©´ ê°’ì„ ë°˜í™˜í•´ì¤€ë‹¤. ì´ ì™¸ì—ë„ ë‹¤ì–‘í•œ ë©”ì„œë“œê°€ ìˆë‹¤.

`categoryId` ê°€ ì—†ìœ¼ë©´ `null` ì´ ë“¤ì–´ê°€ê¸° ë•Œë¬¸ì—, ìˆì„ ìˆ˜ë„ ìˆê³  ì—†ì„ ìˆ˜ë„ ìˆë‹¤ëŠ” ê²ƒì„ ë‚˜íƒ€ë‚´ê¸° ìœ„í•´ `undefined` ë¡œ ì¡ì•„ì¤€ë‹¤.

`ApiService` ì—ì„œ Productsë¥¼ ë¶ˆëŸ¬ì˜¬ ë•Œ `categoryId` ë¥¼ ë„˜ê²¨ì£¼ê¸° ìœ„í•´ì„œ ì—°ê²°ëœ ëª¨ë“  íŒŒì¼ `categoryId` ë¥¼ ì¸ìë¡œ ë°›ì„ ìˆ˜ ìˆê²Œ ê³ ì¹˜ì. ì•„ë¬´ ê°’ë„ ë°›ì§€ ì•Šì„ ê²½ìš°ë¥¼ ëŒ€ë¹„í•´ì„œ ì˜µì…”ë„ í”„ë¡œí¼í‹°ë¥¼ ì¨ì¤€ë‹¤. 

```tsx
// src/pages/ProductListPage.tsx
import { useSearchParams } from 'react-router-dom';

import Products from '../components/product-list/Products';

import useFetchProducts from '../hooks/useFetchProducts';

export default function ProductListPage() {
  const [params] = useSearchParams();

  const categoryId = params.get('categoryId') ?? undefined;

  const { products } = useFetchProducts({ categoryId });

  return (
    <div>
      <h2>Products</h2>
      <Products products={products} />
    </div>
  );
}
```

### ğŸ³ 2-2. ë°›ì•„ì˜¨ ì¹´í…Œê³ ë¦¬ idì— í•´ë‹¹í•˜ëŠ” ìƒí’ˆë§Œ ë¶ˆëŸ¬ì˜¤ê¸°

`useEffectOnce` ëŒ€ì‹  `useEffect` ë¥¼ ì“°ëŠ” ì´ìœ ëŠ” categoryIdê°€ ë°”ë€” ë•Œë§ˆë‹¤ ë¶ˆëŸ¬ì™€ì•¼ í•˜ê¸° ë•Œë¬¸ì´ë‹¤.

ë¬¼ë¡  storeê°€ ì‹±ê¸€í†¤ì´ê³  ë°”ë€Œì§„ ì•ŠëŠ”ë‹¤. ê·¸ëŸ¼ì—ë„ storeë¥¼ ê°€ì ¸ë‹¤ ì“°ë‹ˆê¹Œ ì¨ì£¼ëŠ”ê²Œ ë§ë‹¤.

```tsx
// src/hooks/useFetchProducts.ts
export default function useFetchProducts({
  categoryId,
} : {categoryId? : string}) {
  const store = container.resolve(ProductsStore);

  const [{ products }] = useStore(store);

  useEffect(() => {
    store.fetchProducts({ categoryId });
  }, [store, categoryId]);

  return ({
    products,
  });
}
```

```tsx
// src/stores/ProductsStore.ts
export default class ProductsStore {
  products: ProductSummary[] = [];

  async fetchProducts({ categoryId } : { categoryId?: string }) {
    this.setProducts([]);

    const products = await apiService.fetchProducts({ categoryId });

    this.setProducts(products);
  }

  @Action()
  setProducts(products: ProductSummary[]) {
    this.products = products;
  }
}
```

```tsx
// src/services/ApiService.ts
import axios from 'axios';
import { Category, ProductSummary } from '../types';

const API_BASE_URL = process.env.API_BASE_URL
                     || 'https://shop-demo-api-01.fly.dev';

export default class ApiService {
  private instance = axios.create({
    baseURL: API_BASE_URL,
  });

  async fetchCategories(): Promise<Category[]> {
    const { data } = await this.instance.get('/categories');
    const { categories } = data;
    return categories;
  }

  async fetchProducts({ categoryId }: {
    categoryId?: string
  } = {}): Promise<ProductSummary[]> {
    const { data } = await this.instance.get('/products', {
      params: { categoryId },
    });
    const { products } = data;
    return products;
  }
}

export const apiService = new ApiService();
```

axiosì—ì„œ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¥¼ ë„˜ê²¨ì¤„ ë•Œ, pathì— ì§ì ‘ ì¨ë„ ë˜ê³  ìœ„ ì½”ë“œì²˜ëŸ¼ ë”°ë¡œ ì ì–´ì¤˜ë„ ëœë‹¤.

## ğŸ‹ Test

ì´ì œ ìƒí’ˆ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ê²ƒê³¼ ê´€ë ¨í•˜ì—¬ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆë‹¤. 

ë¼ìš°íŠ¸ í…ŒìŠ¤íŠ¸ì—ì„œëŠ” ì „ì²´ ëª©ë¡ì„ ë¶ˆëŸ¬ì™”ì„ ë•Œ ì–´ë–¤ ìƒí’ˆì´ ë³´ì´ëŠ”ì§€, ì¹´í…Œê³ ë¦¬ ëª©ë¡ì—ì„œ í•´ë‹¹ ì¹´í…Œê³ ë¦¬ ìƒí’ˆë§Œ ë³´ì´ëŠ”ì§€ ë“±ì„ ì²´í¬í•  ìˆ˜ ìˆë‹¤.

ë˜í•œ E2E í…ŒìŠ¤íŠ¸ë¥¼ codeceptjsë¡œ ë©”ë‰´ì—ì„œ ì „ì²´ ìƒí’ˆ ë˜ëŠ” ì¹´í…Œê³ ë¦¬ ë©”ë‰´ë¥¼ í´ë¦­í–ˆì„ ë•Œ ì •ìƒì ìœ¼ë¡œ ìƒí’ˆë“¤ì´ ë³´ì´ëŠ”ì§€ë„ ì²´í¬í•  ìˆ˜ ìˆë‹¤.

> TODO : í…ŒìŠ¤íŠ¸ ì½”ë“œ ì¶”ê°€

