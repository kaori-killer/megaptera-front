# ìƒí’ˆ ìƒì„¸ í˜ì´ì§€ ë³´ì—¬ì£¼ê¸°

ìƒí’ˆì˜ ìƒì„¸ í˜ì´ì§€ë¥¼ ë³´ì—¬ì£¼ê¸° ìœ„í•´ì„œ ì•„ë˜ ë‹¨ê³„ë¥¼ ê±°ì¹œë‹¤.

1. ìƒí’ˆ ìƒì„¸ ë°ì´í„° ë°›ì•„ì˜¤ê¸°
  - loading, error ì²˜ë¦¬í•˜ê¸°
  - ìƒí’ˆ ë°ì´í„° ì²˜ë¦¬í•˜ê¸°

2. ìƒí’ˆ ìƒì„¸ ë°ì´í„° ë³´ì—¬ì£¼ê¸°: `ProductDetail` ì»´í¬ë„ŒíŠ¸

3. ì¡°í•©í•˜ê¸°: `ProductDetailPage` ì—ì„œ 1,2 í•©ì¹˜ê¸°

## ğŸ‹ 3. ì¡°í•©í•˜ê¸°

ì¡°í•©í•  í˜ì´ì§€ë¥¼ `ProductDetailPage` ë¥¼ ì¤€ë¹„í•œë‹¤.

`useParams` ëŠ” ë¦¬ì•¡íŠ¸ ë¼ìš°í„°ì—ì„œ ì œê³µí•˜ëŠ” í›…ìœ¼ë¡œ Route pathë¥¼ ê°€ì ¸ì˜¨ë‹¤. ìƒì„¸ í˜ì´ì§€ëŠ” `useParams` ë¥¼ ì´ìš©í•´ ìƒí’ˆì˜ idë¥¼ ë°›ì•„ì™€ ìƒí’ˆ ë°ì´í„°ë¥¼ ì¡°íšŒí•œë‹¤.

ìƒí’ˆ ëª©ë¡ ì»´í¬ë„ŒíŠ¸ì—ì„œëŠ” ë°ì´í„°ë¥¼ ë°›ì•„ì˜¤ëŠ” ë™ì•ˆ ë¡œë”©, ì—ëŸ¬ë¥¼ ì²˜ë¦¬í•˜ì§€ ì•Šì•˜ë‹¤. í•˜ì§€ë§Œ ì—¬ê¸°ì„œëŠ” storeì—ì„œ ì´ë¥¼ ì²˜ë¦¬í•˜ê²Œ ë§Œë“¤ì—ˆë‹¤.

```tsx
// src/pages/ProductDetailPage.tsx
import { useParams } from 'react-router-dom';

import ProductDetail from '../components/product-list/ProductDetail';

import useFetchProduct from '../hooks/useFetchProduct';

export default function ProductDetailPage() {
  const params = useParams();

  const { loading, error } = useFetchProduct({
    productId: String(params.productId),
  });

  if (loading) return <p>Loading...</p>;

  if (error) return <p>Error!</p>;

  return (
    <ProductDetail />
  );
}
```

## ğŸ‹ 1. ìƒí’ˆ ë°ì´í„° ë°›ì•„ì˜¤ê¸°

### ğŸ³ 1-1. loading, error ì²˜ë¦¬í•˜ê¸°

`ProductDetailPage` ì—ì„œëŠ” loading, error ìƒíƒœë§Œ ë°›ì•„ì˜¤ë„ë¡ í–ˆë‹¤. ë§Œì•½ ìƒí’ˆ ë°ì´í„°ë„ ë°›ì•„ì™€ ë‚´ë ¤ì£¼ê²Œ ëœë‹¤ë©´, ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸° ê¸°ëŠ¥ì„ ì¶”ê°€í–ˆì„ ë•Œ `props drilling` ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.

ë”°ë¼ì„œ ìƒí’ˆ ì •ë³´ëŠ” `ProductDetail` ì»´í¬ë„ŒíŠ¸ì—ì„œ ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œ ë°›ì•„ê°€ë„ë¡ í•˜ê³ , `ProductDetailPage` ì—ì„œëŠ” ìƒí’ˆ ì •ë³´ë¥¼ ë‹¤ë£¨ì§€ ì•ŠëŠ”ë‹¤.

ì´ì œ fetch productë¥¼ í•  ë•Œ loading, error ë¥¼ ë°›ì•„ì˜¬ ìˆ˜ ìˆê²Œ ì²˜ë¦¬í•˜ì.

```ts
// src/stores/ProductDetailStore.ts
import { singleton } from 'tsyringe';

import { Store, Action } from 'usestore-ts';

import { apiService } from '../services/ApiService';

import { ProductDetail, nullProductDetail } from '../types';

@singleton()
@Store()
export default class ProductDetailStore {
  product: ProductDetail = nullProductDetail;

  loading = true;

  error = false;

  async fetchProduct({ productId }: {
    productId: string;
  }) {
    this.startLoading();

    try {
      const product = await apiService.fetchProduct({ productId });
      this.setProduct(product);
    } catch {
      this.setError();
    }
  }

  @Action()
  private startLoading() {
    this.product = nullProductDetail;
    this.loading = true;
    this.error = false;
  }

  @Action()
  private setProduct(product: ProductDetail) {
    this.product = product;
    this.loading = false;
    this.error = false;
  }

  @Action()
  private setError() {
    this.product = nullProductDetail;
    this.loading = false;
    this.error = true;
  }
}
```

loading, error ìƒí™©ì— ë”°ë¼ ì§‘ì  ê°ê°ì˜ ìƒíƒœë¥¼ ë°”ê¿”ì£¼ëŠ” ë“± ë§˜ì— ë“œëŠ” ë°©ì‹ì„ ì„ íƒí•˜ë©´ ëœë‹¤. ì•„ìƒ¬ë‹˜ì€ ìœ„ ì½”ë“œì²˜ëŸ¼ ì´í•´í•˜ê¸° ì‰½ê²Œ í”Œë¡œìš° ìˆœì„œëŒ€ë¡œ ì‘ì„±í•˜ì…¨ë‹¤.

storeì—ì„œ fetch productë¥¼ ìœ„í•œ axios ë¶€ë¶„ì„ ì‘ì„±í•˜ì.

```ts
// src/services/ApiService.ts
export default class ApiService {

  // ...
  
  async fetchProduct({ productId } : {
    productId : string
  }): Promise<ProductDetail> {
    const { data } = await this.instance.get(`/products/${productId}`);
    return data;
  }
}

export const apiService = new ApiService();
```

ì´ì œ storeë¥¼ ì´ìš©í•´ `useFetchProduct` ì»¤ìŠ¤í…€ í›…ì„ ì‘ì„±í•œë‹¤. 

ì•ì—ì„œë„ ì–¸ê¸‰í–ˆë“¯ì´ `useFetchProduct` ì»¤ìŠ¤í…€ í›…ì—ì„œ ì§ì ‘ì ìœ¼ë¡œ ìƒí’ˆ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ì§€ ì•ŠëŠ”ë‹¤.

ëŒ€ì‹  ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ê³¼ì •ì— ìˆì–´ì„œ ë³€í•˜ëŠ” loading ê³¼ error ìƒíƒœë¥¼ ê°€ì ¸ì™€ì„œ `ProductDetailPage` ì»´í¬ë„ŒíŠ¸ì— ë°˜ì˜í•˜ê³  ìƒí™©ì— ë§ëŠ” í™”ë©´ì„ ë³´ì—¬ì¤€ë‹¤.

```ts
// src/hooks/useFetchProduct.ts
import { useEffect } from 'react';
import { container } from 'tsyringe';
import { useStore } from 'usestore-ts';

import ProductStore from '../stores/ProductStore';

const useFetchProduct = ({ productId } : {
    productId: string;
}) => {
  const store = container.resolve(ProductStore);

  const [{ loading, error }] = useStore(store);

  useEffect(() => {
    store.fetchProduct({ productId });
  }, [store, productId]);

  return ({
    loading,
    error,
  });
};

export default useFetchProduct;
```

### Null Object

ë°ì´í„°ê°€ nullì¸ ìƒí™©ì¸ ì´ˆê¹ƒê°’ì„ ëŒ€ë¹„í•˜ì—¬ ì ë‹¹í•œ Null Objectë¥¼ ë§Œë“¤ì–´ì¤€ë‹¤. ì•„ìƒ¬ë‹˜ì€ `types.ts` íŒŒì¼ì— Null Object ë¥¼ ë§Œë“¤ì–´ ë‘ì—ˆë‹¤.

```ts
export const nullProductDetail: ProductDetail = {
  id: '',
  category: { id: '', name: '' },
  images: [],
  name: '',
  price: 0,
  options: [],
  description: '',
};
```

ì•„ë˜ì²˜ëŸ¼ í•´ë„ ë˜ì§€ë§Œ, nullì„ ì•ˆ ì“°ê¸° ìœ„í•´ì„œ ìœ„ì²˜ëŸ¼ í•œë‹¤. null ì²´í¬ë¥¼ í•˜ëŠ” ê²ƒë„ ê·€ì°®ê³  ì—ëŸ¬ê°€ ì•ˆ ë‚˜ëŠ” ìƒí™©ì„ ë§Œë“¤ê¸° ìœ„í•´ì„œì´ë‹¤.

```ts
export const nullProductDetail: ProductDetail | null = null
````


### ğŸ³ 1-2. ìƒí’ˆ ë°ì´í„° ì²˜ë¦¬í•˜ê¸°

ì§€ê¸ˆê¹Œì§€ëŠ” loading, error ìƒíƒœë¥¼ ë°›ì•„ì˜¤ê¸° ìœ„í•œ êµ¬ì„±ì„ í–ˆë‹¤. ì´ì œ `ProductDetail` ì»´í¬ë„ŒíŠ¸ì— ìƒí’ˆ ìƒì„¸ ì •ë³´ë¥¼ ì£¼ê¸° ìœ„í•´ì„œ ìƒí’ˆ ë°ì´í„°ë¥¼ ë°›ì•„ì˜¤ì.

`useFetchProductDetail` ì»¤ìŠ¤í…€ í›…ì„ ìƒì„±í•œë‹¤. ì´ëŠ” `ProductDetailStore` ì— ìˆëŠ” ìƒíƒœë¥¼ ê°€ì ¸ë‹¤ ì“°ëŠ” ì»¤ìŠ¤í…€ í›…ì´ë‹¤.

`ProductDetail` ì»´í¬ë„ŒíŠ¸ì—ì„œ `useFetchProductDetail` ë¥¼ í†µí•´ ìƒí’ˆ ì •ë³´ë¥¼ ë°›ì•„ì˜¬ ìˆ˜ ìˆê²Œ ëœë‹¤.

```ts
// src/hooks/useFetchProductDetail.ts
import { container } from 'tsyringe';
import { useStore } from 'usestore-ts';

import ProductDetailStore from '../stores/ProductDetailStore';

const useProductDetailStore = () => {
  const store = container.resolve(ProductDetailStore);
  return useStore(store);
};

export default useProductDetailStore;
```

`useFetchProductDetail` ë¥¼ ë§Œë“¤ì—ˆìœ¼ë‹ˆ ê¸°ì¡´ì˜ `useFetchProduct` ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë°©ì‹ì„ ë°”ê¿”ì£¼ì.

```ts
// src/hooks/useFetchProduct.ts
import { useEffect } from 'react';

import useProductDetailStore from '../stores/useProductDetailStore';

const useFetchProduct = ({ productId } : {
    productId: string;
}) => {
  const [{ loading, error }, store] = useProductDetailStore();

  useEffect(() => {
    store.fetchProduct({ productId });
  }, [store, productId]);

  return { loading, error };
};

export default useFetchProduct;
```

## ğŸ‹ 2. ìƒí’ˆ ë°ì´í„° ë³´ì—¬ì£¼ê¸°

`useProductDetailStore` ë¥¼ í†µí•´ ìƒí’ˆ ìƒì„¸ ë°ì´í„°ë¥¼ ë°›ì•„ì™€ í™”ë©´ì„ êµ¬ì„±í•œë‹¤. 

ìŠ¤íƒ€ì¼ì´ ë“¤ì–´ê°€ê±°ë‚˜ ë°ì´í„°ë¥¼ ì¶”ê°€ì ìœ¼ë¡œ ê°€ê³µí•  í•„ìš”ê°€ ìˆì„ ë•Œ, ì»´í¬ë„ŒíŠ¸ë¥¼ ë¶„ë¦¬í•´ì£¼ë©´ ê¹”ë”í•œ ì •ë¦¬ê°€ ê°€ëŠ¥í•˜ë‹¤.

```tsx
// src/components/product-list/ProductDetail.tsx
import styled from 'styled-components';

import useProductDetailStore from '../../hooks/useProductDetailStore';

import Images from './Images';
import Description from './Description';

const Container = styled.div`
  display: flex;
  justify-content: space-between;

  aside {
    width: 38%;
  }

  article {
    width: 60%;
  }
`;

export default function ProductDetail() {
  const [{ product }] = useProductDetailStore();

  return (
    <Container>
      <aside>
        <Images images={product.images} />
      </aside>
      <article>
        <h2>{product.name}</h2>
        <AddToCartForm /> {/* ì¶”í›„ ì¶”ê°€ ì˜ˆì • */}
        <Description value={product.description} />
      </article>
    </Container>
  );
}
```

```tsx
// src/components/product-detail/Images.tsx
import styled from 'styled-components';

import { Image } from '../../types';

const Thumbnail = styled.img.attrs({
  alt: 'Product Image',
})`
  display: block;
  width: 100%;
  aspect-ratio: 1/1;
`;

export default function Images({ images } : {
  images : Image[]
}) {
  const [image] = images;

  if (!image) {
    return null;
  }

  return (
    <Thumbnail src={image.url} />
  );
}
```

Descriptionì— ë°ì´í„°ê°€ ë“¤ì–´ì˜¬ ë•Œ ì—¬ëŸ¬ ì¤„ì˜ ë¬¸ìì—´ì´ í•œ ë¬¸ì¥ìœ¼ë¡œ í•©ì³ì ¸ìˆë‹¤. ì´ë¥¼ í™”ë©´ì—ì„œ ë³´ê¸° ì¢‹ê²Œ ë¿Œë¦¬ê¸° ìœ„í•´ spilitê³¼ mapì„ ì´ìš©í•˜ì—¬ ê°€ê³µí•œë‹¤.

ê·¸ë¦¬ê³  keyë¡œ ì¡ì•„ì¤„ë§Œí•œ ëšœë ·í•˜ê²Œ êµ¬ë¶„ë˜ëŠ” idê°™ì€ ë°ì´í„°ê°€ ì—†ì–´ì„œ indexì™€ ìë¥¸ ë¬¸ìì—´ì„ í•©ì³ì„œ keyë¡œ ì§€ì •í–ˆë‹¤. ë Œë”ë§ êµ¬ë¬¸ì—ì„œ keyì— indexë¥¼ ì“°ë ¤ê³  í•˜ë©´ eslintê°€ ê²½ê³ ë¥¼ ì£¼ê¸° ë•Œë¬¸ì— í•¨ìˆ˜ë¡œ ë”°ë¡œ ë¹¼ëŠ” ê¼¼ìˆ˜ë¥¼ ì´ìš©í•´ì„œ ì´ë¥¼ í”¼í•  ìˆ˜ ìˆë‹¤.

```tsx
// src/components/product-detail/Description.tsx
import styled from 'styled-components';

function key(value: string, index: number) {
  return `${index}-${value}`;
}

const Container = styled.div`
  li {
    min-height: 1rem;
    line-height: 1.4;
  }
`;

export default function Description({ value } : {
    value : string
  }) {
  if (!value.trim()) {
    return null;
  }

  const lines = value.split('\n');

  return (
    <Container>
      <ul>
        {lines.map((line, index) => (
          <li key={key(line, index)}>
            {line}
          </li>
        ))}
      </ul>
    </Container>
  );
}
```

## ğŸ‹ Test

### í…ŒìŠ¤íŠ¸ í•­ëª©

ìƒí’ˆ ìƒì„¸ í˜ì´ì§€ ê´€ë ¨í•´ì„œ í…ŒìŠ¤íŠ¸ë¥¼ í•  í•­ëª©ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

- routes
  - ì˜¬ë°”ë¥¸, ì˜¬ë°”ë¥´ì§€ ì•Šì€ pathë¡œ ì´ë™ ì‹œ ë§ëŠ” í™”ë©´ì´ ë‚˜ì˜¤ëŠ”ì§€ ì²´í¬í•œë‹¤.
- ìƒí’ˆ ë””ë°ì¼ ì»´í¬ë„ŒíŠ¸
  - ì˜¬ë°”ë¥¸ pathë¡œ ì´ë™í•˜ì—¬ í˜ì´ì§€ê°€ ë¡œë“œëœ ë‹¤ìŒì„ ì²´í¬í•œë‹¤.
    - ë¡œë”© í™”ë©´ ì²´í¬í•œë‹¤.
    - ìƒí’ˆ ì •ë³´(í…ìŠ¤íŠ¸) ì²´í¬í•œë‹¤.
    - ìƒí’ˆ ì •ë³´ ì¤‘ í•œ ê°€ì§€ ì´ìƒì´ ì—†ì„ ë•Œë¥¼ ì²´í¬í•œë‹¤.
    
### í…ŒìŠ¤íŠ¸ ì‹œ ê°€ì§œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ë•Œ

ë‘˜ ì¤‘ í¸í•œ ë°©ë²•ì„ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

ë°©ë²•1. jest.mockìœ¼ë¡œ fetch ì»¤ìŠ¤í…€ í›…ì„ ê°€ë¡œì±„ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¨ë‹¤.
ë°©ë²•2. í…ŒìŠ¤íŠ¸ ì½”ë“œ ë‚´ì—ì„œ container.resolve(store)ë¥¼ store ë‚´ actionìœ¼ë¡œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° beforeEachë¡œ ë¹¼ì£¼ë©´ í¸í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

