# TDD

화이팅

## :whale2: 키워드

* TDD
* Jest
* Describe - Context - It 패턴
* 단위테스트

## TDD (Test, Driven Development 테스트 주도 개발)

프론트엔드에서 TDD는 구현보다 `인터페이스`와 `스펙`을 먼저 정의함으로서 개발을 진행하는 방식이다.

```typescript
// 인터페이스, 화면이 아니라 다음과 같은 시그니처를 모아놓은 것이다.
add(x, y)->number

// 스펙, 이런게 있고 이걸 실행하면 이렇게 된다
x랑 y를 넣었더니 더해진다.
```

> TDD는 문제를 해결해 나가는 의식적인 수련장치이다. 테스트 코드를 짜는 것에 한정되지 않는다. 빠르게 피드백을 얻음으로서 테스트 코드가 부산물로 남는다. TDD로 인해 결정과 피드백 사이의 갭을 점차 줄여 나갈 수 있다.

## TDD 순서는?

테스트를 추가한다. → 실패한다. → 통과 되도록 코드를 작성한다. → 리펙터링, 중복을 제거한다.

자동화된 테스트를 만들기 위헤서 테스트 코드를 먼저 작성하는 것이다. 작게 하나씩 일정 수준에 다다를 때까지 반복한다.

## TDD Cycle 이란?

### 1단계: Red: 실패하는 테스트 코드를 작성한다

인터페이스에 스펙을 어떻게 테스트 코드로 잘 쓸까에 집중한다. 작은 단계를 찾아야 한다.

큰 단위로 하면 반복을 못한다. 1분 이하로 1단계를 가져오면 베스트이다. 최대 10분 안에서 한 사이클을 돌려야 한다.
1번에서 2번으로 가는 시간이 오래 걸리면 1번을 복잡하게 작성한 것이다.

코드에서 피드백을 얻는 게 중요하다.

> 작은 단위로 진행하는 것도 맞지만, 중요한 점은 핵심을 포함하게 진행해야 한다는 점이다. 내가 올바른 방향으로 가고 있는지 피드백을 받으며 진행해야 한다.
> 그리고 다음 작은 단위는 핵심과 가까우면서 할 수 있는 것을 선택해야 한다.

### 2단계: Green: 재빨리 테스트를 통과시킨다

재빨리 테스트를 통과시킨다. 막무가내로 블루트포스를 쓰던 상관없다. 일단 통과시킨다. 캔트백은 빨리 통과시키기 위해서 죄악을 저질러도 된다고 했다.

우리는 처음부터 완벽한 해법을 내려고 하면 어렵다. 일단 통과하게 만든 다음에 구현을 조금씩 고쳐보는식으로 진행헤야 한다.
TDD가 목표로 하는 것은 1. 제대로 작동하는 2. 클린코드이다. 따라서 일단 제대로 작동하면 된다.

만약, 어떻게든 재빨리 테스트를 통과시키고 싶은데 너무 어렵다면? 1번이 너무 큰거다. 한번에 할 수 있는게 아닌 거다. 더 작고 더 쉬운 문제로 정의해야 한다.

### 3단계: Refactoring: 막 만들었던 것을 고친다

리팩토링이 지향하는 바는 동작은 바꾸지 않고 설계만 바꾸는 것이다. 즉, 어떻게 작동하는지 스펙은 바꾸지 않는다. 내부에 구현 된 코드만 바꾼다.

만약, 리팩토링이 어려우면? 중복을 제거하는 연습을 해야한다. 의도를 드러내면 저절로 중복이 드러나는 경우가 있다. 이를 모아서 처리할 수 있다.

> 따라서 의도를 드러내기 위한 중복은 허용된다.

## TDD에 대해서 주의할 점

### 무조건 테스트 코드를 먼저 작성한다고 TDD가 아니다

TDD Cycle 에 따라 테스트 코드를 먼저 작성하고, 구현하고, 리팩터링 하는 과정을 엄격하게 지켜서 개발을 진행해야 TDD 라고 할 수 있다.

테스트 코드를 작성하는 것과 별개로 따로 연습이 필요하고 습관을 들여야하는 분야이다. TDD를 잘 하기 위해서는 테스트 코드 작성법 자체부터 공부 해야 한다.

당장은 TDD보다 테스트 코드 작성에 익숙해지고, 어떻게 하면 테스트 코드를 잘 작성할 수 있을까에 초점을 맞춰 공부해야 한다.

> 이걸 지키면서 코드를 작성하기가 생각보다 어렵다. 2단계를 뛰어넘고 처음부터 제대로 된 코드를 작성하려고 하게 된다.

### 더 작은 문제 만들기, 의도를 드러내고 중복을 제거하기

이게 익숙하지 않으면 TDD가 어렵게 느껴진다. 하지만 이건 TDD의 문제가 아니라, 개발 자체도 어려워할 것이다. 당연히 개발 잘하기 위해서 갖춰야 하는 조건들이다.

연습해라.

> 프로그래머스를 풀면서 연습하자

## Jest

페이스북에서 만든 테스트 라이브러리이다.
쓸만하다 싶은 것들은 다 들어있고 사용법도 단순하다.

이런 도구를 쓸 줄 알아야 테스트 연습을 하던지 말던지 한다.

## 테스트 케이스를 정의할 때?

테스트 케이스를 정의할 때 크게 두 가지 방법을 사용한다.

1. 테스트 함수로 개별 테스트를 나열하는 방식
2. BDD 스타일로 주체 - 행위 중심으로 테스트를 조직화하는 방식

> 아샬은 1번을 먼저하고 2번으로 한다.
> 테스트 파일 양식은 App.test.ts, App.spec.ts(BDD 스타일) 그냥 test.ts로 통일해서 써도 괜찮다.

## jest.config.js 파일 생성 및 작성

이 파일이 없으면 자바스크립트로 인식해서 타입스크립트를 못쓴다.

## 계속 실행

```bash
npx jest ---watchAll
```

## 연습하기

```typescript
function add(x: number): number {
    return 1 + 2;
}

test('add', () => {
    expect(add(1, 2)).toBe(3);
});

//  

// 다음과 같이 1을 x로 바꾸는 것은 1이 중복되는 상황을 제거하고, 의도를 드러내는 것이다.
function add(x: number): number {
    return x + 2;
}
```

## BDD

어떤 것을 테스트할 것이다. 그리고 그것이 어떻게 될 것이다. 라는 것을 드러낼 수 있다.
describe는 it과 붙여서 말이 된다. `~는 ~가 된다.`

하나 일 때는 개별 테스트를 나열하는 방식으로 작성하고, 여러가지 경우가 있으면 BDD 스타일로 쓴다.

```typescript
test('add', () => {
    expect(add(1, 2)).toBe(3);
});

Describe('add', () => {
    it('returns sum of two numbers', () => {
        expect(add(1, 2)).toBe(3);
    });
 });
 ```

context는 지원하지 않는다. 다음과 같이 모양을 잡아준다.
context는 when 또는 with로 많이 쓴다.

```typescript
const context = describe;
```

```typescript
describe('add', () => {
 context('with no arguments ', () => {
  it('returns the zero', () => {
   expect(add()).toBe(0);
  });
 });

 context('with only one arguments ', () => {
  it('returns the same number', () => {
   expect(add(2)).toBe(2);
  });
 });

 context('with two arguments', () => {
  it('returns sum of two numbers', () => {
   expect(add(1, 2)).toBe(3);
  });
 });

 context('with three arguments', () => {
  it('returns sum of three numbers', () => {
   expect(add(1, 2, 3)).toBe(6);
  });
 });

 context('with ten arguments', () => {
  it('returns sum of ten numbers', () => {
   expect(add(1, 2, 3, 4, 5, 6, 7, 8, 9, 10)).toBe(55);
  });
 });
});
```

> 테스트 할 게 많아지면 개별 테스트에 주석으로 설명을 적는 것보다, BDD 스타일로 작성하는 것이 좋다.
